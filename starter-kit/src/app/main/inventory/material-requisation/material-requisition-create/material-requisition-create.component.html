<div class="mrq-page">
  <div class="mrq-card">

    <!-- âœ… TOP HEADER (Title + Breadcrumb + Save/Close at right) -->
    <div class="mrq-topbar">
      <div class="mrq-topbar-left">
        <h2 class="mrq-heading">Material Requisition Form</h2>
        <div class="mrq-subheading">Inventory â†’ Material Requisition</div>
      </div>

      <div class="mrq-topbar-right">
        <button class="mrq-btn mrq-btn-primary" type="button" (click)="save()">
          <span class="ico">ðŸ’¾</span> Save
        </button>

        <button class="mrq-btn mrq-btn-light" type="button" (click)="close()">
          <span class="ico">âœ•</span> Close
        </button>
      </div>
    </div>

    <!-- âœ… Header fields (only 3) -->
    <div class="mrq-form mrq-form-3">

      <!-- Outlet -->
      <div class="mrq-field">
        <label>Outlet</label>

        <ng-select
          class="mrq-outlet-ng"
          [items]="OutletList"
          bindLabel="name"
          bindValue="id"
          [(ngModel)]="header.OutletId"
          placeholder="Select Outlet"
          [searchable]="true"
          [clearable]="false"
        >
          <ng-template ng-option-tmp let-item="item">
            {{ item.name }}
          </ng-template>
        </ng-select>
      </div>

      <div class="mrq-field">
        <label>Requester Name</label>
        <input class="mrq-input" type="text" [(ngModel)]="header.requesterName" readonly />
      </div>

      <div class="mrq-field">
        <label>Requested Date</label>
        <div class="mrq-date">
          <input class="mrq-input" type="date" [(ngModel)]="header.date" />
        </div>
      </div>
    </div>

    <!-- âœ… Grid -->
    <div class="mrq-grid-wrap">
      <table class="mrq-grid">
        <thead>
          <tr>
            <th class="col-no">#</th>
            <th class="col-item">Item</th>
            <th class="col-sku">SKU</th>
            <th class="col-uom">UOM</th>
            <th class="col-qty">Qty (Enter)</th>
            <th class="col-act">Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let row of lines; let i = index">
            <td class="col-no">{{ i + 1 }}</td>

            <td class="col-item">
              <ng-select
                class="mrq-ng"
                [(ngModel)]="row.itemId"
                [items]="items"
                bindLabel="name"
                bindValue="id"
                [searchable]="true"
                [searchFn]="searchFn"
                [clearable]="true"
                appendTo="body"
                placeholder="Select Item"
                dropdownPosition="bottom"
                (change)="onItemChanged(i)"
              >
                <ng-template ng-option-tmp let-item="item">
                  <div class="opt-row">
                    <div class="opt-name">{{ item.name }}</div>
                    <div class="opt-sub">{{ item.sku }} â€¢ {{ item.uom }}</div>
                  </div>
                </ng-template>

                <ng-template ng-label-tmp let-item="item">
                  {{ item.name }} ({{ item.sku }})
                </ng-template>
              </ng-select>
            </td>

            <td class="col-sku">
              <input class="mrq-input" type="text" [value]="row.sku" readonly />
            </td>

            <td class="col-uom">
              <input class="mrq-input" type="text" [value]="row.uom" readonly />
            </td>

            <td class="col-qty">
              <input
                class="mrq-input qty"
                type="number"
                min="0"
                placeholder="Enter qty"
                [(ngModel)]="row.qty"
              />
            </td>

            <td class="col-act">
              <button
                type="button"
                class="mrq-row-remove"
                title="Remove row"
                (click)="removeRow(i)"
                [disabled]="lines.length === 1"
              >
<i class="fas fa-trash-alt"></i>
              </button>
            </td>
          </tr>
        </tbody>
      </table>

 <div class="mrq-grid-footer">
  <button class="mrq-addline-btn" type="button" (click)="addRow()">
    + Add line
  </button>
</div>
    </div>

  </div>
</div>
