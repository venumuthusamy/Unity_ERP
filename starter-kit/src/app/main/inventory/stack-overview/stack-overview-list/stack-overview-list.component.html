<div class="content-body">
  <section class="users-list-wrapper">
    <div class="card">
      <div class="row">
        <!-- Title + page size -->
        <div class="col-md-6 col-12">
          <h4 class="card-text ml-2 mt-2" style="font-size:1.25rem;font-weight:600;color:#2E5F73">
            Stock Overview List
          </h4>

          <div class="d-flex justify-content-between align-items-center m-1">
            <label class="d-flex align-items-center">
              Show
              <select class="form-control mx-2" [(ngModel)]="pageSize">
                <option *ngFor="let s of pageSizes" [value]="s">{{ s }}</option>
              </select>
              entries
            </label>
          </div>
        </div>

        <!-- Search + Create -->
        <div class="col-md-6 col-12 d-flex justify-content-start justify-content-md-end">
          <div class="d-flex align-items-center justify-content-end pr-1 pb-1 pb-md-0">
            <label class="d-flex align-items-center ml-1 ml-md-0">Search:
              <input
                [(ngModel)]="searchValue"
                type="search"
                class="form-control ml-2"
                (input)="applyFilter()"
                placeholder="Item / SKU / Category / UOM / Warehouse / Bin" />
            </label>

            <button
              (click)="goToCreateItem()"
              class="btn m-1 d-inline-flex align-items-center"
              style="background-color:#2E5F73; color:white; gap:6px;">
              <i class="fas fa-plus-circle"></i>
              <span>Go to Overview</span>
            </button>
          </div>
        </div>
      </div>

      <!-- Loading / Error -->
      <div *ngIf="loading" class="px-3 pb-2 small text-muted">Loading items…</div>
      <div *ngIf="errorMsg" class="alert alert-danger mx-3 my-2">{{ errorMsg }}</div>

      <!-- NGX DATATABLE -->
<!-- NGX DATATABLE -->
<ngx-datatable
  class="bootstrap core-bootstrap item-table"
  [rows]="filteredRows"
  [rowHeight]="50"
  [headerHeight]="50"
  [footerHeight]="50"
  [limit]="pageSize"
  [columnMode]="'force'"
  [scrollbarH]="false"
  [reorderable]="true"
  [rowIdentity]="rowIdentity"
  [trackByProp]="'id'">

  <!-- NEW: View column BEFORE SKU -->
  <!-- <ngx-datatable-column
    [width]="60"
    [sortable]="false"
    [canAutoResize]="false">
    <ng-template ngx-datatable-header-template>
    </ng-template>
    <ng-template let-row="row" ngx-datatable-cell-template>
      <div class="d-flex align-items-center justify-content-center">
        <i class="fas fa-eye"
          title="View stock by warehouse/bin"
          style="cursor:pointer; color:#2E5F73;"
          (click)="openViewModal(row, viewModal)"></i>
      </div>
    </ng-template>
  </ngx-datatable-column> -->


            <ngx-datatable-column [width]="60" [resizeable]="false" [sortable]="false" [draggable]="false" [canAutoResize]="false">
            <ng-template ngx-datatable-cell-template let-row="row">
              <span (click)="openViewModal(row, viewModal)" title="View stock by warehouse/bin" style="cursor:pointer;font-size:18px;color:#2E5F73;">
                <i class="fas fa-eye"></i>
              </span>
            </ng-template>
          </ngx-datatable-column>


  <!-- SKU (now appears after the eye icon) -->
  <ngx-datatable-column name="SKU" prop="sku" [width]="140"></ngx-datatable-column>
  <ngx-datatable-column name="Item Name" prop="name" [width]="160"></ngx-datatable-column>
  <ngx-datatable-column name="Category" prop="category" [width]="160"></ngx-datatable-column>
  <ngx-datatable-column name="UOM" prop="uom" [width]="120"></ngx-datatable-column>

  <!-- Optional totals -->
  <ngx-datatable-column name="Total On Hand" [width]="140">
    <ng-template let-row="row" ngx-datatable-cell-template>
      {{ row.totalOnHand ?? 0 }}
    </ng-template>
  </ngx-datatable-column>
  <!-- <ngx-datatable-column name="Total Reserved" [width]="140">
    <ng-template let-row="row" ngx-datatable-cell-template>
      {{ row.totalReserved ?? 0 }}
    </ng-template>
  </ngx-datatable-column> -->
  <ngx-datatable-column name="Total Available" [width]="150">
    <ng-template let-row="row" ngx-datatable-cell-template>
      {{ row.totalAvailable ?? 0 }}
    </ng-template>
  </ngx-datatable-column>

  <!-- Action column (now ONLY edit) -->
  <!-- <ngx-datatable-column
    name="Action"
    [width]="100"
    [sortable]="false"
    [canAutoResize]="false">
    <ng-template let-row="row" ngx-datatable-cell-template>
      <div class="d-flex align-items-center justify-content-center gap-3">
        <i class="fas fa-pen"
          title="Edit"
          style="cursor:pointer; color:#2E5F73;"
          (click)="editItem(row.id)"></i>
      </div>
    </ng-template>
  </ngx-datatable-column> -->

</ngx-datatable>

    </div>
  </section>
</div>

<!-- View Modal -->
<ng-template #viewModal let-close="close" let-dismiss="dismiss">
  <div class="modal-header">
    <h5 class="modal-title">
      {{ selectedItem?.name }} ({{ selectedItem?.sku }}) – Stock by Location
    </h5>
    <button type="button" class="close" aria-label="Close" (click)="dismiss('x')">
      <span aria-hidden="true">&times;</span>
    </button>
  </div>

  <div class="modal-body">
    <div class="table-responsive border rounded">
      <table class="table table-sm mb-0">
        <thead class="bg-light">
          <tr>
            <th style="background-color:#2E5F73;color:white;">Warehouse</th>
            <th style="background-color:#2E5F73;color:white;">Bin / Location</th>
            <th style="background-color:#2E5F73;color:white;" class="text-right">On Hand</th>
            <th style="background-color:#2E5F73;color:white;" class="text-right">Reserved</th>
            <th style="background-color:#2E5F73;color:white;" class="text-right">Available</th>
            <th style="background-color:#2E5F73;color:white;"class="text-right">Min</th>
            <th style="background-color:#2E5F73;color:white;"class="text-right">Max</th>
            <th style="background-color:#2E5F73;color:white;">Expiry</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let l of selectedItem?.locations; let i = index"
              [style.background]="i % 2 === 0 ? '#fcfdff' : '#ffffff'">
            <td>{{ l.warehouseName || '-' }}</td>
            <td>{{ l.binName || '-' }}</td>
            <td class="text-right">{{ l.onHand ?? 0 }}</td>
            <td class="text-right">{{ l.reserved ?? 0 }}</td>
            <td class="text-right">{{ l.available ?? 0 }}</td>
            <td class="text-right">{{ l.minQty ?? 0 }}</td>
            <td class="text-right">{{ l.maxQty ?? 0 }}</td>
            <td>{{ l.expiryDate ? (l.expiryDate | date:'yyyy-MM-dd') : '-' }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-outline-secondary" (click)="close('ok')">Close</button>
  </div>
</ng-template>
