<!-- Back -->


<div class="tw-page">
<button class="tw-back-btn mb-3" type="button" (click)="goToStockTransferList()">
  <i class="fas fa-arrow-left tw-back-ico" aria-hidden="true"></i>
  <span>Go to Stock Transfer list</span>
</button>
  <div class="tw-card" *ngIf="header as h">

    <!-- Header -->
    <div class="tw-card-head">
      <div class="tw-head-left">
        <div class="tw-title-row">
          <h4 class="tw-title mb-0">Transfer Details</h4>

          <span class="tw-pill" [ngClass]="isEditMode ? 'tw-pill-warn' : 'tw-pill-info'">
            {{ isEditMode ? 'Edit Mode' : 'Create Mode' }}
          </span>
        </div>

        <div class="tw-sub">
          Material Requisition based stock transfer
        </div>
      </div>

      <div class="tw-head-right">
        <div class="tw-metrics">
          <div class="tw-metric">
            <div class="tw-metric-label">Requested</div>
            <div class="tw-metric-val">{{ requestedQty ?? 0 }}</div>
          </div>
          <div class="tw-metric-sep"></div>
          <div class="tw-metric">
            <div class="tw-metric-label">Available</div>
            <div class="tw-metric-val">{{ totalAvailable ?? 0 }}</div>
          </div>
        </div>
      </div>
    </div>

    <!-- Body -->
    <div class="tw-card-body">
      <div class="row g-3">

        <!-- MRQ -->
        <div class="col-12 col-md-6">
          <label class="tw-label">Material Requisition</label>
          <div class="tw-field">
            <input class="form-control tw-input tw-readonly" [value]="h.reqNo" readonly />
          </div>
        </div>

        <!-- SKU -->
        <div class="col-12 col-md-6">
          <label class="tw-label">SKU</label>
          <div class="tw-field">
            <input class="form-control tw-input tw-readonly" [value]="h.sku" readonly />
          </div>
        </div>

        <!-- From Outlet -->
        <div class="col-12 col-md-6">
          <label class="tw-label">From Outlet</label>
          <div class="tw-field">
            <input class="form-control tw-input tw-readonly" [value]="h.fromWarehouseName" readonly />
          </div>
        </div>

        <!-- To Outlet -->
        <div class="col-12 col-md-6">
          <label class="tw-label">To Outlet</label>
          <div class="tw-field">
            <input class="form-control tw-input tw-readonly" [value]="h.toWarehouseName" readonly />
          </div>
        </div>

        <!-- Requested Qty -->
        <div class="col-12 col-md-6">
          <label class="tw-label">Requested Qty</label>
          <div class="tw-field">
            <input type="number" class="form-control tw-input tw-readonly" [(ngModel)]="requestedQty" readonly />
          </div>
        </div>

        <!-- To Bin -->
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center justify-content-between">
            <label class="tw-label mb-0">To Bin</label>

            <span class="tw-mini" *ngIf="header?.toWarehouseId">
              ToOutletId: <b>{{ header?.toWarehouseId }}</b>
            </span>
          </div>

          <div class="tw-field tw-ng">
            <ng-select
              [items]="toBinList"
              bindLabel="binName"
              bindValue="id"
              placeholder="Select To Bin"
              [(ngModel)]="toBinId"
              [loading]="toBinLoading"
              [disabled]='true'>
            </ng-select>
          </div>

          <div class="tw-help" *ngIf="header?.toWarehouseId">
            Outlet bins loaded based on selected outlet.
          </div>
        </div>

        <!-- Transfer Qty -->
        <div class="col-12 col-md-6">
          <div class="d-flex align-items-center justify-content-between">
            <label class="tw-label mb-0">Transfer Qty</label>
            <span class="tw-badge">
              Max: {{ maxQty }}
            </span>
          </div>

          <div class="tw-field">
            <input
              type="number"
              class="form-control tw-input"
              [(ngModel)]="transferQty"
              [min]="0"
              [max]="maxQty"
              placeholder="Enter qty" />
          </div>

          <div class="tw-inline-note">
            <span class="tw-dot"></span>
            Requested <b>{{ requestedQty ?? 0 }}</b>
            <span class="mx-2">•</span>
            Available <b>{{ totalAvailable ?? 0 }}</b>
          </div>

          <div class="tw-help" *ngIf="isEditMode && header?.transferQty == null">
            DB TransferQty is NULL → showing 0
          </div>
        </div>

        <!-- Reason -->
        <div class="col-12 col-md-6">
          <label class="tw-label">Reason</label>
          <div class="tw-field">
            <input class="form-control tw-input" [(ngModel)]="reason" placeholder="Reason / remarks" />
          </div>
        </div>

      </div>
    </div>

    <!-- Footer (sticky-ish) -->
    <div class="tw-card-foot">
      <button class="tw-btn tw-btn-ghost" type="button" (click)="goBack()">
        Back
      </button>

      <button
        class="tw-btn tw-btn-primary"
        type="button"
        [disabled]="loading || maxQty === 0"
        (click)="submitTransferFinal()">

        <span *ngIf="!loading">{{ isEditMode ? 'Update Transfer' : 'Submit Transfer' }}</span>
        <span *ngIf="loading">{{ isEditMode ? 'Updating…' : 'Submitting…' }}</span>
      </button>
    </div>

  </div>

</div>
