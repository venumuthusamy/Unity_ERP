<div class="ocr-backdrop" *ngIf="open">
  <div class="ocr-modal">
    <div class="ocr-head">
      <div>
        <div class="ocr-title">Scan / OCR</div>
        <div class="ocr-sub">Upload invoice image and extract invoice fields.</div>
      </div>
      <button type="button" class="ocr-x" (click)="close()">✕</button>
    </div>

    <div class="ocr-body">
      <!-- Left -->
      <div class="ocr-left">
        <div class="ocr-row">
          <label class="ocr-label">Language</label>
          <select class="ocr-input" [(ngModel)]="lang" [ngModelOptions]="{standalone:true}">
            <option value="eng">English (eng)</option>
            <option value="tam">Tamil (tam)</option>
            <option value="eng+tam">English + Tamil (eng+tam)</option>
          </select>
        </div>

        <div class="ocr-row">
          <label class="ocr-label">Upload</label>
          <input class="ocr-input" type="file" accept="image/*" (change)="onPick($event)" />
          <div class="ocr-file" *ngIf="file">{{ file.name }}</div>
        </div>

        <div class="ocr-preview">
          <ng-container *ngIf="previewUrl; else emptyPreview">
            <img [src]="previewUrl" alt="preview" />
          </ng-container>
          <ng-template #emptyPreview>
            <div class="ocr-empty">No image selected</div>
          </ng-template>
        </div>

        <div class="ocr-actions">
          <button type="button" class="btn-ocr" [disabled]="!file || loading" (click)="run()">
            {{ loading ? 'Reading…' : 'Run OCR' }}
          </button>
          <button type="button" class="btn-ocr ghost" (click)="reset()">Reset</button>
        </div>

        <div class="ocr-error" *ngIf="error">{{ error }}</div>
      </div>

      <!-- Right -->
      <div class="ocr-right">
        <div class="ocr-metrics" *ngIf="result">
          <span>Conf: {{ result.meanConfidence | number:'1.2-2' }}</span>
          <span>Words: {{ result.wordCount }}</span>
          <button type="button" class="btn-ocr tiny ghost" (click)="copy()">Copy</button>
        </div>

        <div class="ocr-fields" *ngIf="result">
          <div class="ocr-field"><span>Invoice No</span><b>{{ result.parsed?.invoiceNo || '—' }}</b></div>
          <div class="ocr-field"><span>Invoice Date</span><b>{{ result.parsed?.invoiceDate || '—' }}</b></div>
          <div class="ocr-field"><span>Total</span><b>{{ result.parsed?.total || 0 | number:'1.2-2' }}</b></div>
          <div class="ocr-field"><span>Tax %</span><b>{{ result.parsed?.taxPercent || 0 }}</b></div>
          <div class="ocr-field"><span>Tax Amount</span><b>{{ result.parsed?.taxAmount || 0 | number:'1.2-2' }}</b></div>
        </div>

        <textarea class="ocr-text" [value]="result?.text || ''" readonly placeholder="OCR text output..."></textarea>

        <div class="ocr-apply">
          <button type="button" class="btn-ocr" [disabled]="!result" (click)="applyToFormOnly()">
            Apply to Form
          </button>
          <button type="button" class="btn-ocr ghost" (click)="close()">Close</button>
        </div>
      </div>
    </div>
  </div>
</div>
