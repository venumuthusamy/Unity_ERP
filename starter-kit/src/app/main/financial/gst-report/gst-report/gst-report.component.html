<div class="content-wrapper p-0">
  <div class="content-body gst-page">
    <section class="users-list-wrapper">
      <app-financereports></app-financereports>

      <div class="card shadow-sm gst-card">
        <!-- ========= HEADER ========= -->
        <div class="card-header d-flex justify-content-between align-items-center gst-header">
          <div class="d-flex flex-column">
            <h4 class="mb-0 gst-title">
              GST Details by Transaction
            </h4>
          </div>

          <!-- Export button (opens modal) -->
          <div class="d-flex align-items-center gst-export">
            <button class="btn btn-outline-secondary btn-sm"
                    (click)="openExportModal()"
                    [disabled]="!rows?.length">
              <i class="fas fa-file-export me-25"></i> Export
            </button>
          </div>
        </div>

        <div class="card-body gst-body">

          <!-- ========= TOP SUMMARY CARDS ========= -->
          <div class="row gst-summary-row">
            <!-- Total Taxable -->
            <div class="col-lg-4 col-md-4 col-sm-6 mb-1">
              <div class="gst-summary-card gst-summary-taxable">
                <div class="gst-summary-icon gst-summary-icon-taxable">
                  <i class="fas fa-file-invoice-dollar"></i>
                </div>
                <div class="gst-summary-text">
                  <div class="gst-summary-label">Total Taxable</div>
                  <div class="gst-summary-value">
                    {{ totalTaxable | number:'1.2-2' }}
                  </div>
                  <div class="gst-summary-caption">Sum of taxable base value</div>
                </div>
              </div>
            </div>

            <!-- Total Tax -->
            <div class="col-lg-4 col-md-4 col-sm-6 mb-1">
              <div class="gst-summary-card gst-summary-tax">
                <div class="gst-summary-icon gst-summary-icon-tax">
                  <i class="fas fa-percent"></i>
                </div>
                <div class="gst-summary-text">
                  <div class="gst-summary-label">Total Tax</div>
                  <div class="gst-summary-value">
                    {{ totalTax | number:'1.2-2' }}
                  </div>
                  <div class="gst-summary-caption">Output + Input tax</div>
                </div>
              </div>
            </div>

            <!-- Total Net -->
            <div class="col-lg-4 col-md-4 col-sm-6 mb-1">
              <div class="gst-summary-card gst-summary-net">
                <div class="gst-summary-icon gst-summary-icon-net">
                  <i class="fas fa-dollar-sign"></i>
                </div>
                <div class="gst-summary-text">
                  <div class="gst-summary-label">Total Net</div>
                  <div class="gst-summary-value">
                    {{ totalNet | number:'1.2-2' }}
                  </div>
                  <div class="gst-summary-caption">Taxable + Tax</div>
                </div>
              </div>
            </div>
          </div>

          <!-- ========= FILTER CARD ========= -->
          <div class="gst-filter-card mb-2">

            <!-- 1st row – filters -->
            <div class="row align-items-end">
              <!-- From Date -->
              <div class="col-lg-3 col-md-3 col-sm-6 mb-1">
                <label class="form-label gst-filter-label">From Date</label>
                <input type="date"
                       class="form-control form-control-sm"
                       [(ngModel)]="startDate">
              </div>

              <!-- To Date -->
              <div class="col-lg-3 col-md-3 col-sm-6 mb-1">
                <label class="form-label gst-filter-label">To Date</label>
                <input type="date"
                       class="form-control form-control-sm"
                       [(ngModel)]="endDate">
              </div>

              <!-- Type -->
              <div class="col-lg-3 col-md-3 col-sm-6 mb-1">
                <label class="form-label gst-filter-label">Type</label>
                <select class="form-control form-control-sm" [(ngModel)]="docType">
                  <option value="ALL">All</option>
                  <option value="SI">Sales (Output)</option>
                  <option value="PIN">Supplier (Input)</option>
                </select>
              </div>

              <!-- Search -->
              <div class="col-lg-3 col-md-3 col-sm-6 mb-1">
                <label class="form-label gst-filter-label">Search</label>
                <input type="text"
                       class="form-control form-control-sm"
                       placeholder="Doc / Customer / Supplier"
                       [(ngModel)]="searchText"
                       (keyup.enter)="loadDetails()">
              </div>
            </div>

            <!-- 2nd row – buttons -->
            <div class="row mt-1">
              <div class="col-12 d-flex justify-content-end gst-filter-actions">
                <button class="btn btn-brand btn-sm me-50"
                        (click)="loadDetails()">
                  <i class="fas fa-search me-25"></i> Filter
                </button>
                <button class="btn btn-outline-secondary btn-sm"
                        (click)="resetFilters()">
                  Reset
                </button>
              </div>
            </div>

          </div>

          <!-- ========= TOP "SHOW ENTRIES" ========= -->
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-center mt-1 w-100 gst-pagination-bar">
            <div class="d-flex flex-wrap align-items-center mb-1 mb-md-0">
              <span class="small me-50">Show</span>

              <select class="form-control form-control-sm"
                      style="width: 90px;"
                      [(ngModel)]="pageSize"
                      (ngModelChange)="onPageSizeChange($event)">
                <option *ngFor="let opt of pageSizeOptions" [ngValue]="opt">
                  {{ opt }}
                </option>
              </select>

              <span class="small ms-50">entries</span>
            </div>
          </div>

          <!-- ========= TABLE ========= -->
          <div class="table-responsive gst-table-wrapper" *ngIf="!isLoading; else loadingTpl">
            <table class="table table-hover align-middle mb-0 gst-table">
              <thead>
                <tr>
                  <th class="text-nowrap">Type</th>
                  <th class="text-nowrap">Source</th>
                  <th class="text-nowrap">Date</th>
                  <th class="text-nowrap">Doc No</th>
                  <th class="text-nowrap">Customer / Supplier</th>
                  <th class="text-nowrap text-end">Taxable</th>
                  <th class="text-nowrap text-end">Tax</th>
                  <th class="text-nowrap text-end">Net</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let r of pagedRows">
                  <td>
                    <span class="gst-type-badge"
                          [ngClass]="r.docType === 'SI' ? 'gst-type-sales' : 'gst-type-supplier'">
                      {{ r.docType === 'SI' ? 'Sales' : 'Supplier' }}
                    </span>
                  </td>
                  <td class="text-nowrap">{{ r.source }}</td>
                  <td class="text-nowrap">{{ r.docDate | date:'dd-MMM-yyyy' }}</td>
                  <td class="text-nowrap">{{ r.docNo }}</td>
                  <td class="text-nowrap">{{ r.partyName }}</td>
                  <td class="text-nowrap text-end">
                    {{ r.taxableAmount | number:'1.2-2' }}
                  </td>
                  <td class="text-nowrap text-end">
                    {{ r.taxAmount | number:'1.2-2' }}
                  </td>
                  <td class="text-nowrap text-end">
                    {{ r.netAmount | number:'1.2-2' }}
                  </td>
                </tr>

                <tr *ngIf="!rows?.length">
                  <td colspan="8" class="text-center text-muted small py-2">
                    No GST transactions found for selected criteria.
                  </td>
                </tr>
              </tbody>
            </table>
          </div>

          <ng-template #loadingTpl>
            <div class="gst-loader-wrap">
              <div class="spinner-border spinner-border-sm me-50"></div>
              <span>Loading GST details…</span>
            </div>
          </ng-template>

          <!-- ========= PAGINATION FOOTER ========= -->
          <div class="d-flex flex-column flex-md-row 
                      justify-content-between align-items-center
                      mt-1 w-100 gst-pagination">
            <div class="d-flex flex-wrap align-items-center mb-1 mb-md-0">
              <span class="small text-muted">
                Showing
                <strong>{{ displayFrom }}</strong>
                –
                <strong>{{ displayTo }}</strong>
                of <strong>{{ totalRows }}</strong> entries
              </span>
            </div>

            <ul class="pagination pagination-sm mb-0">
              <li class="page-item" [class.disabled]="page === 1">
                <a class="page-link" href="javascript:void(0)" (click)="prevPage()">‹</a>
              </li>

              <li class="page-item"
                  *ngFor="let p of pages"
                  [class.active]="page === p">
                <a class="page-link" href="javascript:void(0)" (click)="goToPage(p)">
                  {{ p }}
                </a>
              </li>

              <li class="page-item" [class.disabled]="page === totalPages">
                <a class="page-link" href="javascript:void(0)" (click)="nextPage()">›</a>
              </li>
            </ul>
          </div>

        </div>
      </div>
    </section>
  </div>
</div>

<!-- ========= EXPORT MODAL ========= -->
<div class="gst-export-backdrop" *ngIf="showExportModal">
  <div class="gst-export-modal card shadow-sm">
    <div class="card-header d-flex justify-content-between align-items-center">
      <div class="d-flex align-items-center">
        <div class="gst-export-icon me-50">
          <i class="fas fa-file-export"></i>
        </div>
        <h5 class="mb-0">Export GST Details</h5>
      </div>
      <button type="button"
              class="btn btn-sm btn-icon"
              (click)="closeExportModal()">
        <i class="fas fa-times"></i>
      </button>
    </div>

    <div class="card-body">
      <p class="text-muted mb-2 small">
        Choose a format to export.<br>
        <span class="d-block">Tip: exports exactly what you see (current filters applied).</span>
      </p>

      <label class="form-label small mb-25">Filename</label>
      <div class="input-group mb-2">
        <input type="text"
               class="form-control"
               [(ngModel)]="exportFileName">
        <span class="input-group-text small text-muted">.xlsx / .pdf</span>
      </div>

      <!-- NEW BUTTON ROW -->
      <div class="gst-export-actions">
        <button class="btn btn-export-excel"
                (click)="confirmExport('excel')">
          Excel (.xlsx)
        </button>

        <button class="btn btn-export-pdf"
                (click)="confirmExport('pdf')">
          PDF (.pdf)
        </button>
      </div>
    </div>
  </div>
</div>

