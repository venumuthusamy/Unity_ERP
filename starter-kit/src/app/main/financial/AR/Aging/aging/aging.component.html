<div class="content-wrapper p-0">
  <div class="content-body">
    <section class="users-list-wrapper">
      <div class="card shadow-sm ar-card">

        <!-- Header -->
        <div class="card-header d-flex justify-content-between align-items-center">


          <div class="d-flex align-items-center">
            <span class="me-50">From</span>
            <input type="date" class="form-control me-50" style="width: 160px" [(ngModel)]="fromDate"
              (change)="onFilterChange()" />

            <span class="me-50 ms-1">To</span>
            <input type="date" class="form-control" style="width: 160px" [(ngModel)]="toDate"
              (change)="onFilterChange()" />
          </div>
        </div>

        <!-- Summary table -->
        <div class="card-body" *ngIf="!isLoading; else loadingTpl">

          <table class="table table-hover aging-table">
            <thead>
              <tr>
                <th>Customer</th>
                <th class="text-end">0-30</th>
                <th class="text-end">31-60</th>
                <th class="text-end">61-90</th>
                <th class="text-end">90+</th>
                <th class="text-end">Total Outstanding</th>
              </tr>
            </thead>
            <tbody>
              <tr *ngFor="let r of rows" (click)="openDetail(r)" style="cursor: pointer;">
                <td>{{ r.customerName }}</td>
                <td class="text-end">{{ r.bucket0_30 | number : '1.2-2' }}</td>
                <td class="text-end">{{ r.bucket31_60 | number : '1.2-2' }}</td>
                <td class="text-end">{{ r.bucket61_90 | number : '1.2-2' }}</td>
                <td class="text-end">{{ r.bucket90Plus | number : '1.2-2' }}</td>
                <td class="text-end fw-bold">{{ r.totalOutstanding | number : '1.2-2' }}</td>
              </tr>
            </tbody>
          </table>

          <!-- Detail drawer -->
          <div class="mt-2" *ngIf="isDetailOpen">
            <div class="d-flex justify-content-between align-items-center mb-1">
              <h5 class="mb-0">
                Invoices for {{ selectedCustomerName }}
              </h5>
              <button class="btn btn-outline-secondary btn-sm" (click)="closeDetail()">
                Close
              </button>
            </div>

            <table class="table table-sm table-striped aging-table">
              <thead>
                <tr>
                  <th>Invoice</th>
                  <th>Date</th>
                  <th>Due</th>
                  <th class="text-end">OverDue Days</th>
                  <!-- <th class="text-end">Bucket</th> -->
                  <th class="text-end">Original</th>
                  <th class="text-end">Paid</th>
                  <th class="text-end">Credit</th>
                  <th class="text-end">Balance</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let d of detailRows">
                  <td>{{ d.invoiceNo }}</td>
                  <td>{{ d.invoiceDate | date }}</td>
                  <td>{{ d.dueDate | date }}</td>
                  <td class="text-end">{{ d.ageDays }}</td>
                  <!-- <td class="text-end">{{ d.bucketName }}</td> -->
                  <td class="text-end">{{ d.originalAmount | number : '1.2-2' }}</td>
                  <td class="text-end">{{ d.paidAmount | number : '1.2-2' }}</td>
                  <td class="text-end">{{ d.creditAmount | number : '1.2-2' }}</td>
                  <td class="text-end fw-bold">{{ d.balance | number : '1.2-2' }}</td>
                </tr>
              </tbody>
            </table>
          </div>

        </div>

        <ng-template #loadingTpl>
          <div class="p-2 text-center">
            Loading aging dataâ€¦
          </div>
        </ng-template>

      </div>
    </section>
  </div>
</div>