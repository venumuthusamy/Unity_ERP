<div class="content-wrapper container-xxl p-0">
  <div class="content-body">
    <div class="row g-3 metrics-row">
      <div class="col-md-12">
        <div class="card h-100 journal-card">
          <div class="card-body">

            <!-- Header: title + buttons -->
            <div class="journal-header d-flex justify-content-between align-items-center mb-2">
              <div class="d-flex align-items-center">
                <h2 class="journal-title mb-0"
                    style="color:#2E5F73; font-size:20px; font-weight:600;">
                  Journal
                </h2>

                <div *ngIf="isPeriodLocked"
                     class="alert alert-warning py-1 px-2 mx-2 mb-0"
                     style="font-size: 0.8rem;">
                  Period <strong>{{ currentPeriodName || 'current' }}</strong> is locked.
                </div>
              </div>

              <div class="d-flex align-items-center">
                <button
                  (click)="newJournal()"
                  class="btn m-1 d-inline-flex align-items-center"
                  style="background-color:#2E5F73;color:white;gap:6px;"
                  [disabled]="isPeriodLocked"
                  [attr.title]="isPeriodLocked
                    ? (currentPeriodName
                        ? 'Period ' + currentPeriodName + ' is locked'
                        : 'Accounting period is locked')
                    : 'Create Journal'">
                  <i data-feather="plus-circle" class="w-4 h-4"></i>
                  <span>New Journal</span>
                </button>
              </div>
            </div>

            <!-- Filters row (optional) -->
            <div class="row gx-3 gy-3 journal-fields mb-1">
              <!-- Journal Date (filter) -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Journal Date</label>
                <div class="journal-date-group">
                  <input
                    type="date"
                    class="form-control journal-input"
                    [(ngModel)]="journalDate"
                    name="journalDate"
                    (change)="reload()" />
                  <!-- <span class="journal-date-icon">
                    <i data-feather="calendar"></i>
                  </span> -->
                </div>
              </div>

              <!-- Reference search -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Reference</label>
                <input
                  type="text"
                  class="form-control journal-input"
                  placeholder="Search reference / description"
                  [(ngModel)]="reference"
                  name="reference"
                  (keyup.enter)="reload()" />
              </div>

              <!-- Type -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Type</label>
                <ng-select
                  class="w-100 journal-select"
                  [items]="journalTypes"
                  bindLabel="text"
                  bindValue="value"
                  [(ngModel)]="selectedType"
                  name="selectedType"
                  [clearable]="true"
                  placeholder="All"
                  (change)="reload()">
                </ng-select>
              </div>
            </div>

            <!-- Journal list table -->
            <div class="row mt-2">
              <div class="col-12">

                <table class="table table-sm journal-table">
                  <thead>
                    <tr>
                      <th class="jt-header">#</th>
                      <th class="jt-header">Journal No</th>
                      <th class="jt-header">Date</th>
                      <th class="jt-header">Description</th>
                      <th class="jt-header">Entry Type</th>
                      <th class="jt-header">Frequency</th>
                      <th class="jt-header text-right">Debit</th>
                      <th class="jt-header text-right">Credit</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr *ngFor="let row of journalList; let i = index">
                      <td>{{ i + 1 }}</td>

                      <!-- Journal No -->
                      <td>
                        <span class="font-weight-bold">
                          {{ row.journalNo }}
                        </span>
                      </td>

                      <!-- Date -->
                      <td>
                        {{ row.journalDate | date:'dd-MMM-yyyy' }}
                      </td>

                      <!-- Description -->
                      <td>
                        <div class="text-truncate" style="max-width:260px;">
                          {{ row.description }}
                        </div>
                      </td>

                      <!-- Entry Type -->
                      <td>
                        <span
                          class="badge"
                          [ngClass]="row.isRecurring ? 'badge-light-primary' : 'badge-light-secondary'">
                          {{ row.isRecurring ? 'Recurring' : 'One-time' }}
                        </span>
                      </td>

                      <!-- Frequency -->
                      <td>
                        {{ getFrequencyLabel(row.recurringFrequency) }}
                      </td>

                      <!-- Debit total -->
                      <td class="text-right">
                        {{ row.debitAmount | number:'1.2-2' }}
                      </td>

                      <!-- Credit total -->
                      <td class="text-right">
                        {{ row.creditAmount | number:'1.2-2' }}
                      </td>
                    </tr>

                    <tr *ngIf="!journalList || journalList.length === 0">
                      <td colspan="8" class="text-center text-muted py-3">
                        No journal entries.
                      </td>
                    </tr>
                  </tbody>

                  <!-- Totals -->
                  <tfoot *ngIf="journalList && journalList.length">
                    <tr>
                      <th colspan="6" class="text-right">Total</th>
                      <th class="text-right">
                        {{ totalDebit | number:'1.2-2' }}
                      </th>
                      <th class="text-right">
                        {{ totalCredit | number:'1.2-2' }}
                      </th>
                    </tr>
                  </tfoot>
                </table>

                <!-- Post button -->
                <div class="d-flex justify-content-end mt-2">
                  <button
                    type="button"
                    class="btn d-inline-flex align-items-center justify-content-center"
                    style="
                      background-color:#2E5F73;
                      color:white;
                      gap:6px;
                      border-radius:8px;
                      padding:8px 22px;
                      height:40px;
                      font-weight:500;
                      border:2px solid #2E5F73;
                      min-width:140px;
                    "
                    [disabled]="isPeriodLocked || !journalList || !journalList.length"
                    (click)="submit()">
                    <i class="fas fa-check-circle" style="font-size:14px;"></i>
                    <span>Post</span>
                  </button>
                </div>

              </div>
            </div>

          </div><!-- card-body -->
        </div><!-- card -->
      </div>
    </div>
  </div>
</div>
