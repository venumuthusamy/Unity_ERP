<div class="content-wrapper container-xxl p-0">
  <div class="content-body">
    <div class="row g-3 metrics-row">
      <div class="col-md-12">
        <div class="card h-100 journal-card">
          <div class="card-body">

            <!-- Header: title + buttons -->
            <div class="journal-header d-flex justify-content-between align-items-center mb-2">
              <h2 class="journal-title mb-0"
                  style="color:#2E5F73; font-size:20px; font-weight:600;">
                Journal
              </h2>
  <div *ngIf="isPeriodLocked"
                 class="alert alert-warning py-1 px-2 mx-2 mb-2"
                 style="font-size: 0.8rem;">
              Period <strong>{{ currentPeriodName || 'current' }}</strong> is locked.
            </div>
              <div class="d-flex align-items-center">
                <!-- New Journal (Solid Button) -->
                <!-- <button
                  type="button"
                  class="btn m-1 d-inline-flex align-items-center justify-content-center"
                  style="
                    background-color:#2E5F73;
                    color:white;
                    gap:6px;
                    border-radius:8px;
                    padding:8px 18px;
                    height:40px;
                    font-weight:500;
                    border:2px solid #2E5F73;
                    min-width:140px;
                  "
                  (click)="newJournal()">
                  <i class="fas fa-plus-circle" style="font-size:14px;"></i>
                  <span>New Journal</span>
                </button> -->
                <button
                  (click)="newJournal()"
                  class="btn m-1 d-inline-flex align-items-center"
                  style="background-color:#2E5F73;color:white;gap:6px;"
                  [disabled]="isPeriodLocked"
                  [attr.title]="isPeriodLocked
                    ? (currentPeriodName
                        ? 'Period ' + currentPeriodName + ' is locked'
                        : 'Accounting period is locked')
                    : 'Create Journal'">
                  <i data-feather="plus-circle" class="w-4 h-4"></i>
                  <span>New Journal</span>
                  </button>
              </div>
              
            </div>

            <!-- Filters row (optional) -->
            <div class="row gx-3 gy-3 journal-fields mb-1">

              <!-- Journal Date (filter) -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Journal Date</label>
                <div class="journal-date-group">
                  <input
                    type="date"
                    class="form-control journal-input"
                    [(ngModel)]="journalDate"
                    name="journalDate"
                    (change)="reload()" />
                  <span class="journal-date-icon">
                    <i data-feather="calendar"></i>
                  </span>
                </div>
              </div>

              <!-- Reference search -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Reference</label>
                <input
                  type="text"
                  class="form-control journal-input"
                  placeholder="Search reference / description"
                  [(ngModel)]="reference"
                  name="reference"
                  (keyup.enter)="reload()" />
              </div>

              <!-- Type -->
              <div class="col-md-4 col-sm-6">
                <label class="form-label mb-25">Type</label>
                <ng-select
                  class="w-100 journal-select"
                  [items]="journalTypes"
                  bindLabel="text"
                  bindValue="value"
                  [(ngModel)]="selectedType"
                  name="selectedType"
                  [clearable]="true"
                  placeholder="All"
                  (change)="reload()">
                </ng-select>
              </div>
            </div>

       

            <!-- Journal lines table -->
            <div class="row mt-2">
              <div class="col-12">

                <table class="table table-sm journal-table">
                  <thead>
                    <tr>
                      <th class="jt-header">#</th>
                      <th class="jt-header">Account</th>
                      <th class="jt-header">Entry Type</th>
                      <th class="jt-header">Frequency</th>
                      <th class="jt-header text-right">Debit</th>
                      <th class="jt-header text-right">Credit</th>
                    </tr>
                  </thead>

                  <tbody>
                    <tr *ngFor="let row of journalList; let i = index">
                      <td>{{ i + 1 }}</td>

                      <!-- Account -->
                      <td>
                        <span class="font-weight-bold">
                          {{ row.headCode }} - {{ row.headName }}
                        </span>
                      </td>

                      <!-- Per-row Entry Type -->
                      <td>
                        <span
                          class="badge"
                          [ngClass]="row.isRecurring ? 'badge-light-primary' : 'badge-light-secondary'">
                          {{ row.isRecurring ? 'Recurring' : 'One-time' }}
                        </span>
                      </td>

                      <!-- Per-row Frequency -->
                      <td>
                        {{ getFrequencyLabel(row.recurringFrequency) }}
                      </td>

                      <!-- Debit -->
                      <td class="text-right">
                        <input
                          type="number"
                          class="form-control text-right"
                          [(ngModel)]="row.debitAmount"
                          [ngModelOptions]="{ standalone: true }" />
                      </td>

                      <!-- Credit -->
                      <td class="text-right">
                        <input
                          type="number"
                          class="form-control text-right"
                          [(ngModel)]="row.amount"
                          [ngModelOptions]="{ standalone: true }" />
                      </td>
                    </tr>

                    <tr *ngIf="!journalList || journalList.length === 0">
                      <td colspan="6" class="text-center text-muted py-3">
                        No journal lines.
                      </td>
                    </tr>
                  </tbody>

                  <!-- Totals -->
                  <tfoot *ngIf="journalList && journalList.length">
                    <tr>
                      <th colspan="4" class="text-right">Total</th>
                      <th class="text-right">
                        {{ totalDebit | number:'1.2-2' }}
                      </th>
                      <th class="text-right">
                        {{ totalCredit | number:'1.2-2' }}
                      </th>
                    </tr>
                  </tfoot>
                </table>

                <!-- Submit button -->
                <div class="d-flex justify-content-end mt-2">
                  <button
                    type="button"
                    class="btn d-inline-flex align-items-center justify-content-center"
                    style="
                      background-color:#2E5F73;
                      color:white;
                      gap:6px;
                      border-radius:8px;
                      padding:8px 22px;
                      height:40px;
                      font-weight:500;
                      border:2px solid #2E5F73;
                      min-width:140px;
                    "
                    (click)="submit()">
                    <i class="fas fa-check-circle" style="font-size:14px;"></i>
                    <span>Post</span>
                  </button>
                </div>

              </div>
            </div>

          </div><!-- card-body -->
        </div><!-- card -->
      </div>
    </div>
  </div>
</div>
