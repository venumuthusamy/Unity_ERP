<!-- src/app/main/purchase/debit-note/debit-note-create/debit-note-create.component.html -->
<button
  class="btn mb-1"
  style="background-color:#2E5F73; color:white;"
  (click)="goToDebitNoteList()">
  Go to Debit Note list
</button>

<div class="space-y-5 ui-compact pr-typography">
  <div class="bg-white rounded-2xl shadow p-3 border border-gray-100">
    <h2 class="text-lg font-semibold text-gray-800 mb-3">
      Debit Note / Returns
    </h2>

    <!-- Header grid -->
    <div [ngClass]="gridColsClass(4)">
      <!-- Reference -->
      <div>
        <label class="text-xs font-medium text-gray-600">
          Reference (GRN/PIN)
        </label>
        <input
          class="w-full rounded-xl border px-3 py-2 text-sm"
          [(ngModel)]="referenceNo"
          placeholder="GRN-00012" />
      </div>

      <!-- Supplier (read-only from PIN for now) -->
      <div>
        <label class="text-xs font-medium text-gray-600">Supplier</label>
        <input
          class="w-full rounded-xl border px-3 py-2 text-sm bg-gray-50"
          [value]="supplierDisplay"
          readonly />
      </div>

      <!-- Reason -->
      <div>
        <label class="text-xs font-medium text-gray-600">Reason</label>
        <select
          class="w-full rounded-xl border px-3 py-2 text-sm bg-white"
          [(ngModel)]="reason">
          <!-- <option value="Rejected goods">Rejected goods</option> -->
           <option value="Short supply">Short supply</option>
          <option value="Price difference">Price difference</option>
           <option value="Other">Other</option>
        </select>
      </div>

      <!-- Date -->
      <div>
        <label class="text-xs font-medium text-gray-600">Date</label>
        <input
          type="date"
          class="w-full rounded-xl border px-3 py-2 text-sm"
          [(ngModel)]="noteDate" />
      </div>
    </div>

    <!-- Lines table -->
    <div class="overflow-auto border border-gray-200 rounded-xl mt-4">
      <table class="min-w-full text-sm">
        <thead class="text-white" style="background-color:#2E5F73">
          <tr>
            <th class="text-left px-3 py-2 font-medium">Item</th>
            <!-- ðŸ‘‡ renamed to Variance Qty -->
            <th class="text-left px-3 py-2 font-medium">Variance Qty</th>
            <th class="text-left px-3 py-2 font-medium">Price</th>
            <th class="text-left px-3 py-2 font-medium">Remarks</th>
            <th class="px-3"></th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="retRows.length === 0">
            <td [attr.colspan]="5"
                class="px-3 py-6 text-center text-gray-400">
              No lines yet.
            </td>
          </tr>

          <tr *ngFor="let r of retRows; let i = index; trackBy: trackByIndex"
              class="border-t">
            <td class="px-3 py-2">
              <input
                class="w-full rounded-xl border px-3 py-2 text-sm"
                [(ngModel)]="retRows[i].item" />
            </td>
            <td class="px-3 py-2">
              <input
                type="number"
                class="w-full rounded-xl border px-3 py-2 text-sm"
                [(ngModel)]="retRows[i].qty" />
            </td>
            <td class="px-3 py-2">
              <input
                type="number"
                class="w-full rounded-xl border px-3 py-2 text-sm"
                [(ngModel)]="retRows[i].price" />
            </td>
            <td class="px-3 py-2">
              <input
                class="w-full rounded-xl border px-3 py-2 text-sm"
                [(ngModel)]="retRows[i].remarks" />
            </td>
            <td class="px-3 py-2 text-right">
              <button
                class="px-3 py-2 rounded-xl text-sm font-medium hover:bg-gray-100 border border-transparent"
                type="button"
                (click)="retRemoveRow(i)">
                Remove
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <div class="p-2 border-t bg-gray-50 flex justify-between items-center">
        <button
          class="px-3 py-2 rounded-xl text-sm font-medium text-white"
          type="button"
          (click)="retAddRow()"
          [style.backgroundColor]="'#2E5F73'">
          + Add line
        </button>

        <div class="pr-3 text-sm font-semibold">
          Total: {{ totalAmount | number:'1.2-2' }}
        </div>
      </div>
    </div>

    <!-- Footer buttons -->
    <div class="mt-3 flex gap-2 justify-end">
      <button
        class="btn btn-outline-secondary"
        type="button"
        (click)="goToDebitNoteList()">
        Cancel
      </button>
      <!-- <button
        class="btn btn-warning"
        type="button"
        (click)="save(false)">
        Save as Draft
      </button> -->
      <button
        class="btn btn-primary"
        type="button"
        (click)="save(true)">
        Post Debit Note
      </button>
    </div>
  </div>
</div>
